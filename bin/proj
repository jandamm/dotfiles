#!/bin/bash

# shellcheck source=../scripts/tmux_window_support.sh
source "$HOME/.scripts/tmux_window_support.sh"

## returns folder name
get_name_from() {
	local p
	p="$( cd "$1" || exit ; pwd -P)"; echo "${p//*\//}"
}

function proj() {
	local wd
	wd="$(cd "$1" || exit ; pwd -P)"
	# Check if directory was provided
	if [ -n "$wd" ]; then

		# create new session if there is none
		tmux-create-session

		local name
		name=$(get_name_from "$wd")

		# Check if tmux has a window for this folder
		if [ -z "$(has_window_with_name "$name")" ]; then
			tmux new-window -c "$wd" -n "$name" >> /dev/null

			# Check if existing window is active
		elif [ -z "$(window_with_name_active "$name")" ]; then
			# Select window if not active
			select_window "$name"
		fi

		# Start tmux if not in tmux already
		if [ -z "$TMUX" ]; then
			tmux a
		fi
	fi
}

proj "$@"
