#!/usr/bin/env sh
set -e

if [ "$1" = 'apply' ]; then
	shift

	# TODO: cleanup
	# TODO: preselect oldest not pushed commit

	sha=$(git fzf-log-one --prompt='Fixup> ' --header='Select the oldest commit before a fixed commit.')

	git rebase --interactive --autosquash "${sha%% *}"
	exit
fi

sha=$(git fzf-log-one --prompt='Fixup> ')

git commit --fixup "${sha%% *}"
